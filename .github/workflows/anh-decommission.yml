name: Decommission Notification Hub
run-name: Decommission ANH

on:
  workflow_dispatch:
    inputs:
      subscription_id:
        description: 'Azure Subscription ID'
        required: true
      resource_group_name:
        description: 'Resource Group Name'
        required: true
      

      confirm_destroy:
        description: 'Type DESTROY to confirm decommission'
        required: true
        type: string

env:
  ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  ARM_CLIENT_SECRET: ${{ secrets.ARM_CLIENT_SECRET }}
  ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
  ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}

  TF_VAR_subscription_id: ${{ inputs.subscription_id }}
  TF_VAR_resource_group_name: ${{ inputs.resource_group_name }}


jobs:
  confirm:
    name: Confirm Destruction
    runs-on: ubuntu-latest
    steps:
      - name: Validate confirmation
        run: |
          if [ "${{ inputs.confirm_destroy }}" != "DESTROY" ]; then
            echo "❌ You must type DESTROY to proceed"
            exit 1
          fi
          echo "✅ Confirmation accepted"

  decommission:
    name: Decommission ANH
    uses: ./.github/workflows/reusable-service-decommission.yml
    needs: confirm
    with:
      service_name: ANH
      working_directory: terragrunt/ANH
      subscription_id: ${{ inputs.subscription_id }}
      resource_group_name: ${{ inputs.resource_group_name }}
    secrets: inherit
